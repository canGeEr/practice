<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      margin: 0;
    }

    .bottom,
    .top {
      height: 200px;
      width: 200px;
    }

    .top {
      background-color: red;
    }

    .bottom {
      position: absolute;
      background-color: aqua;
      top: 0;
    }
  </style>
</head>

<body>
  <div class="top"></div>
  <div class="bottom"></div>
  <div>
    Lorem ipsum dolor sit amet consectetur adipisicing elit. Vero consectetur iusto doloribus nisi commodi. Unde, sit,
    error eum labore reprehenderit rerum atque vero delectus, quibusdam voluptatem consequuntur incidunt esse nemo.
  </div>

  <script>
    function jsonP(url, params, options = {}) {
      const { onSuccess, onFail } = options;
      const callbackName = `jsonp_${new Date().getTime()}`;
      url = generateUrl(url, {
        ...params,
        callbackName,
      });
      const script = document.createElement("script");
      script.type = "text/javascript";
      script.async = true;
      script.src = url;
      // 挂载回调函数到window上
      Object.defineProperty(window, callbackName, {
        value: (res) => {
          onSuccess?.(res);
          clear();
        },
        writable: false,
        enumerable: false,
        configurable: true,
      });
      script.onerror = function () {
        onFail?.("error");
        clear();
      };
      // 插入开始生效
      document.body.appendChild(script);

      function clear() {
        document.body.removeChild(script);
        delete window[callbackName];
      }
    }

    function generateUrl(url, params) {
      const urlParser = new URL(url);
      const { searchParams } = urlParser;
      for (let key of Object.keys(params)) {
        searchParams.append(key, params[key]);
      }
      return urlParser.toString();
    }

    jsonP('https://www.baidu.com')
  </script>
</body>

</html>